<div class="chat-wrapper">
  <aside class="contacts">
    <header>
      <h2>Chats</h2>
      <div class="user-meta">
        <span class="username">{{ currentUser() }}</span>
        <button (click)="logout()">⏻</button>
      </div>
    </header>

    <div class="contact-list">
      <div *ngFor="let u of contacts()" (click)="select(u)" [ngClass]="{ active: activeId() === u.id }" class="contact">
        <div class="avatar">{{ u.username.charAt(0) | uppercase }}</div>
        <div class="info">
          <span>{{ u.username }}</span>
          <small [class.online]="u.online">
            {{ u.online ? "online" : "offline" }}
          </small>
        </div>

        <div *ngIf="unread[u.id] > 0 && activeId() !== u.id" class="badge">
          {{ unread[u.id] }}
        </div>
      </div>
    </div>
  </aside>

  <section class="chat-area" *ngIf="activeId(); else placeholder">
    <header class="chat-header" *ngIf="activeUser() as user">
      <div class="user-info">
        <h3>{{ user.username }}</h3>
        <small [class.online]="user.online">
          {{ user.online ? "Online" : "Offline" }}
        </small>
      </div>
      <div class="actions">
        <button>📞</button>
        <button>🎥</button>
        <button>⋮</button>
      </div>
    </header>

    <div class="messages" #messagesContainer (scroll)="onScroll()">
      <div *ngFor="let m of thread()" [ngClass]="{ me: m.from === meId, peer: m.from !== meId }" class="msg-bubble">
        <p>{{ m.text }}</p>
        <small>{{ formatTime(m.ts) }}</small>
      </div>
    </div>


    <footer class="chat-input">
      <form (ngSubmit)="send()">
        <input [(ngModel)]="draft" name="draft" placeholder="Type a message..." />
        <button type="submit">➤</button>
      </form>
    </footer>
  </section>

  <ng-template #placeholder>
    <section class="chat-placeholder">
      <p>Select a conversation to start chatting 👋</p>
    </section>
  </ng-template>
</div>